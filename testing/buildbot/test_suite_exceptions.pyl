# Copyright 2017 The Chromium Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# This is a .pyl, or "Python Literal", file. You can treat it just like a
# .json file, with the following exceptions:
# * all keys must be quoted (use single quotes, please);
# * comments are allowed, using '#' syntax; and
# * trailing commas are allowed.

# Exceptions to the common test suites can only include removal from
# particular bots, and modifications on particular bots. By design,
# it's not possible to add one-off tests to bots. Instead they have to
# be added to one of the test suites in test_suites.pyl.
#
# Note that if you are excluding with variants, you will need to exclude
# per variant, with the identifier appended to the test suite name.
# For example, if you have ios_chrome_ui_eg2tests_module with variant
# SIM_IPHONE_6S_14_0 (identifier = "iPhone 6s 14.0"), you
# must exclude with the test name as:
# "ios_chrome_ui_eg2tests_module_iPhone 6s 14.0"

# The goal is to drive the number of exceptions to zero, to make all
# the bots behave similarly. whitespace
{
  'accessibility_unittests': {
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        'args': [
            # TODO(crbug.com/40266898): Re-enable.
          '--gtest_filter=-AXPlatformNodeAuraLinuxTest.AtkComponentScrollTo:'
          'AtkUtilAuraLinuxTest.*',
        ],
      },
    },
  },
  'android_browsertests': {
    'modifications': {
      'android-asan': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'android_webview_unittests': {
  },
  'angle_unittests': {
    'remove_from': [
      # Times out listing tests crbug.com/1167314
      'android-asan',
    ],
    'modifications': {
      'linux-chromeos-rel': {
        # b/41493162: angle_unittests has a high failure rate.
        # Re-enable cq when the issue is fixed.
        'ci_only': True,
      },
    },
  },
  'blink_web_tests': {
    'modifications': {
      'Mac Tests Siso FYI': {
        'swarming': {
          'dimensions': {
            'gpu': None,
          },
          'shards': 12,
        },
      },
      'V8 Blink Linux Future': {
        'args': [
          '--flag-specific=future-js',
        ],
      },
      'WebKit Linux ASAN': {
        'args': [
          '--timeout-ms',
          '48000',
        ],
        'swarming': {
          'shards': 8,
        },
      },
      'WebKit Linux Leak': {
        'args': [
          '--timeout-ms',
          '48000',
        ],
        'swarming': {
          'shards': 4,
        },
      },
      'WebKit Linux MSAN': {
        'args': [
          '--timeout-ms',
          '66000',
        ],
        'swarming': {
          'expiration': 36000,
          'hard_timeout': 10800,
          'io_timeout': 3600,
          'shards': 8,
        },
      },
      'devtools_frontend_linux_blink_light_rel': {
        'args': [
          'http/tests/devtools',
        ],
        'swarming': {
          'shards': 2,
        },
      },
      'devtools_frontend_linux_blink_light_rel_fastbuild': {
        'args': [
          'http/tests/devtools',
        ],
        'swarming': {
          'shards': 2,
        },
      },
      'linux-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'linux-blink-wpt-reset-rel': {
        'args': [
          '--additional-driver-flag=--force-browsing-instance-reset-between-tests',
        ],
        # The flag above will slow the tests down, and we don't want the bot to
        # timeout, so set a higher timeout here.
        # TODO(wjmaclean): It would be nice if we could somehow specify a delta
        # to the default/inherited timeout instead of an absolute.
        'swarming': {
          'hard_timeout': 1500,
        },
      },
      'linux-layout-tests-edit-ng': {
        'args': [
          '--flag-specific=enable-editing-ng',
        ],
      },
      'mac-osxbeta-rel': {
        'swarming': {
          'dimensions': {
            'gpu': None
          },
          'shards': 10,
        },
      },
      'mac11.0-blink-rel': {
        'swarming': {
          'shards': 5,
          'hard_timeout': 2400,
        },
      },
      'mac11.0.arm64-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'mac12.0-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'mac12.0.arm64-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'win10-rel-no-external-ip': {
        'swarming': {
          "shards": 12
        },
      },
      'win10.20h2-blink-rel': {
        'swarming': {
          'shards': 6,
          'hard_timeout': 2400,
        },
      },
      'win11-arm64-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'win11-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
    },
  },
  'blink_wpt_tests': {
    'remove_from': [
      'devtools_frontend_linux_blink_light_rel',
      'devtools_frontend_linux_blink_light_rel_fastbuild',
    ],
    'modifications': {
      'Mac Tests Siso FYI': {
        'swarming': {
          'dimensions': {
            'gpu': None,
          },
          'shards': 18,
        },
      },
      'V8 Blink Linux Future': {
        'args': [
          '--flag-specific=future-js',
        ],
      },
      'WebKit Linux ASAN': {
        'args': [
          '--timeout-ms',
          '48000',
        ],
        'swarming': {
          'shards': 12,
        },
      },
      'WebKit Linux Leak': {
        'args': [
          '--timeout-ms',
          '48000',
        ],
        'swarming': {
          'shards': 6,
        },
      },
      'WebKit Linux MSAN': {
        'args': [
          '--timeout-ms',
          '66000',
        ],
        'swarming': {
          'expiration': 36000,
          'hard_timeout': 10800,
          'io_timeout': 3600,
          'shards': 12,
        },
      },
      'linux-bfcache-rel': {
        'args': [
          # TODO(crbug.com/40200069): Re-enable the test.
          '--ignore-tests=external/wpt/html/browsers/browsing-the-web/back-forward-cache/events.html',
        ],
      },
      'linux-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'linux-blink-wpt-reset-rel': {
        'args': [
          '--additional-driver-flag=--force-browsing-instance-reset-between-tests',
        ],
      },
      'linux-layout-tests-edit-ng': {
        'args': [
          '--flag-specific=enable-editing-ng',
        ],
      },
      'mac-osxbeta-rel': {
        'swarming': {
          'dimensions': {
            'gpu': None
          },
          'shards': 18,
        },
      },
      'mac11.0-blink-rel': {
        'swarming': {
          'shards': 7,
          'hard_timeout': 2400,
        },
      },
      'mac11.0.arm64-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'mac12.0-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'mac12.0.arm64-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'win10-rel-no-external-ip': {
        'swarming': {
          "shards": 18
        },
      },
      'win10.20h2-blink-rel': {
        'swarming': {
          'shards': 9,
          'hard_timeout': 2400,
        },
      },
      'win11-arm64-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
      'win11-blink-rel': {
        'swarming': {
          'hard_timeout': 2400,
        },
      },
    },
  },
  'browser_tests': {
    'remove_from': [
      'Linux TSan Tests',  # https://crbug.com/368525
      'linux-chromeos-chrome-preuprev', # http://b/331706144
    ],
    'modifications': {
      'Linux - Future (dbg)': {  # client.v8.chromium
        'swarming': {
          'shards': 10,
        },
      },
      'Linux ASan LSan Tests (1)': {
        'ci_only': True,
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 40,
        },
      },
      'Linux CFI': {
        'swarming': {
          'shards': 20,  # https://crbug.com/1361973
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        # And even more slow on linux-chromeos: crbug.com/1491533.
        'swarming': {
          'shards': 140,
          'hard_timeout': 7200,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot, most likely because browser_tests on cros has ~40% more tests. Also, these tests
        # run on ash, which means every test starts and shuts down ash, which most likely explains why it takes longer than on other platforms.
        # crbug.com/40585695 and crbug.com/326621525
        'swarming': {
          'shards': 100,
        },
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.msan.browser_tests.oobe_negative.filter',
        ],
      },
      'Linux MSan Tests': {
        'swarming': {
          'shards': 23,
        },
      },
      'Mac ASan 64 Tests (1)': {
        'swarming': {
          'shards': 30,
        },
        # crbug.com/1196416
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/mac.mac-rel.browser_tests.filter',
        ],
        'experiment_percentage': 100, # https://crbug.com/1251657
      },
      'Mac Builder Next': {
        'swarming': {
          'shards': 20,  # crbug.com/1419045
        },
      },
      'Mac Tests Siso FYI': {
        'ci_only': True,
        'swarming': {
          'shards': 20,  # crbug.com/1361887
        },
      },
      'linux-chromeos-chrome': {
        # TODO(crbug.com/40614042): Promote out of experiment when the
        # tests are green.
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.browser_tests.filter',
        ],
        'swarming': {
          'shards': 20,
        },
      },
      'linux-chromeos-dbg': {
        'swarming': {
          'shards': 140,
        },
      },
      'linux-chromeos-dbg-oslogin': {
        'swarming': {
          'shards': 110,
        },
      },
      'linux-chromeos-rel': {
        # Only retry the individual failed tests instead of rerunning entire
        # shards.
        # crbug.com/1473501
        'retry_only_failed_tests': True,
        'swarming': {
          'shards': 60,
          'dimensions': {
            'kvm': '1',
          },
        },
      },
      'linux-ubsan-fyi-rel': {
        'swarming': {
          'shards': 20,
        }
      },
      'mac-osxbeta-rel': {
        'swarming': {
          'shards': 30,
        },
      },
      'win-asan': {
         # Tests shows tests run faster with fewer retries by using fewer jobs crbug.com/1411912
        'args': [
          '--test-launcher-jobs=3',
        ],
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 60,
        },
      },
      'win10-rel-no-external-ip': {
        # crbug.com/868082
        'args': [
          '--disable-features=WebRTC-H264WithOpenH264FFmpeg',
        ],
        'swarming': {
          'shards': 15,
        }
      },
    },
  },
  'browser_tests_no_field_trial': {
    'remove_from': [
      'win10-rel-no-external-ip',
    ],
  },
  'capture_unittests': {
    'modifications': {
      'WebRTC Chromium Linux Tester': {
        'swarming': {
          'dimensions': {
            'os': 'Ubuntu-22.04|Ubuntu-18.04',
          },
        },
      },
    },
  },
  'cc_unittests': {
    'modifications': {
      'Linux TSan Tests': {
        'swarming': {
          'shards': 3,
        },
      },
    },
  },
  'check_static_initializers': {
    'modifications': {
      'Mac Builder': {
        'args': [
          '--allow-coverage-initializer',
        ],
      },
    },
  },
  'chrome_all_tast_tests': {
    'modifications': {
      'chromeos-amd64-generic-rel-tast': {
        'args': [
          '--tast-shard-method=hash',
        ],
      },
      'chromeos-eve-chrome': {
        'swarming': {
          # Increased timeout to 4 hours due to shard timeout.
          'hard_timeout': 14400,
        }
      },
      # TODO(crbug.com/40727045): Move out of experimental if/when the bots are
      # stable.
      'chromeos-jacuzzi-chrome': {
        'experiment_percentage': 100,
      },
      'chromeos-reven-chrome': {
        'args': [
          '--tast-shard-method=hash',
        ],
      },
    },
  },
  'chrome_public_test_apk': {
    'remove_from': [
      'android-asan',  # https://crbug.com/964562
    ],
    'modifications': {
      'android-pie-arm64-rel-dev': {
        'swarming': {
          'service_account': 'chrome-gold-dev@chops-service-accounts.iam.gserviceaccount.com'
        },
      },
    },
  },
  'chrome_public_test_vr_apk': {
    'remove_from': [
      'android-asan',  # https://crbug.com/964562
    ],
  },
  'chrome_public_unit_test_apk': {
    'remove_from': [
      'android-asan',  # https://crbug.com/964562
    ],
  },
  'components_browsertests': {
    'modifications': {
      'Linux TSan Tests': {
        'swarming': {
          'shards': 2,
        },
      },
      'android-asan': {
        'swarming': {
          'shards': 3,
        },
      },
    },
  },
  'components_browsertests_no_field_trial': {
    'remove_from': [
      'win10-rel-no-external-ip',
    ],
  },
  'components_unittests': {
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 5,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 5,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 2,
        },
      },
      'win-asan': {
        # TODO(crbug.com/41491387): With a single shard seems to hit time limit.
        'swarming': {
          'shards': 4,
        },
      },
    },
  },
  'content_browsertests': {
    'remove_from': [
      'linux-chromeos-chrome-preuprev', # http://b/331706144
    ],
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        'swarming': {
          'shards': 24,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        'swarming': {
          'shards': 14, # https://crbug.com/1471857
        },
      },
      'Linux MSan Tests': {
        'swarming': {
          'shards': 10, # https://crbug.com/1497706
        },
      },
      'Linux TSan Tests': {
        'ci_only': True, # https://crbug.com/1498240
        'swarming': {
          'shards': 30,
        },
      },
      'Mac ASan 64 Tests (1)': { # https://crbug.com/1200640
        'experiment_percentage': 100,
      },
      'Mac Tests Siso FYI': {
        # Only retry the individual failed tests instead of rerunning entire
        # shards.
        # crbug.com/1475852
        'retry_only_failed_tests': True,
        'swarming': {
          'shards': 12,
        },
      },
      'WebRTC Chromium FYI Android Tests (dbg)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromium.webrtc.fyi.android.tests.dbg.content_browsertests.filter',
        ],
      },
      'WebRTC Chromium FYI Android Tests ARM64 (dbg)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromium.webrtc.fyi.android.tests.dbg.content_browsertests.filter',
        ],
      },
      'android-asan': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.asan.content_browsertests.filter',
        ],
        'swarming': {
          'shards': 25,
        },
      },
      'linux-chromeos-dbg': {
        'swarming': {
          'shards': 16,
        },
      },
      'linux-chromeos-dbg-oslogin': {
        'swarming': {
          'shards': 16,
        },
      },
      'linux-chromeos-rel': {
        # Only retry the individual failed tests instead of rerunning entire
        # shards.
        # crbug.com/1475852
        'retry_only_failed_tests': True,
        'swarming': {
          'shards': 6,
        },
      },
      'linux-ubsan-fyi-rel': {
        'swarming': {
          'shards': 16,
        }
      },
      # https://crbug.com/1255940
      'mac-rel-dev': {
        'swarming': {
          'dimensions': {
            # These test would time out when running on 4 cores instances.
            'cores': '8|12',
          },
        },
      },
      'win-asan': {
         # Tests shows tests run faster with fewer retries by using fewer jobs crbug.com/1411912
        'args': [
          '--test-launcher-jobs=3',
        ],
        'swarming': {
          # ASAN bot is slow: https://crbug.com/1484550#c3
          'shards': 32,
        },
      },
      'win10-rel-no-external-ip': {
        # crbug.com/868082
        'args': [
          '--disable-features=WebRTC-H264WithOpenH264FFmpeg',
        ],
      },
    },
  },
  'content_shell_test_apk': {
    'remove_from': [
      'android-asan',  # https://crbug.com/964562
    ],
  },
  'content_unittests': {
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 2,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'context_lost_metal_passthrough_ganesh_tests': {
    'remove_from': [
      # crbug.com/1458020 for Mac Retina ASAN removal
      'Mac FYI Retina ASAN (AMD)',
    ],
  },
  'context_lost_metal_passthrough_graphite_tests': {
    'remove_from': [
      # crbug.com/1458020 for Mac Retina ASAN removal
      'Mac FYI Retina ASAN (AMD)',
    ],
  },
  'context_lost_passthrough_tests': {
    'modifications': {
      'Win10 FYI x64 Experimental Release (Intel)': {
        'args': [
          # TODO(crbug.com/41496675): Apply this via magic subustitutions if it
          # helps with stability.
          '--jobs=2',
        ],
      },
    },
    'replacements': {
      'Win10 FYI x64 Experimental Release (Intel)': {
        'args': {
          # Magic substitution happens after regular replacement, so remove it
          # now since we are manually applying the number of jobs above.
          '$$MAGIC_SUBSTITUTION_GPUParallelJobs': None,
        },
      },
    },
  },
  'context_lost_validating_tests': {
    # TODO(crbug.com/40039565): Remove the Android FYI Release (Pixel 2)
    # exception once there is enough capacity to run these tests.
    'remove_from': [
      'Android FYI Release (Pixel 2)',
    ],
  },
  'crashpad_tests': {
    'remove_from': [
      # https://crbug.com/crashpad/304
      'Linux TSan Tests',
      # https://crbug.com/crashpad/306
      'Linux CFI',
    ],
    'modifications': {
      # TODO(crbug.com/40794640): dyld was rebuilt for macOS 12, which breaks
      # the tests. Run this experimentally on all the macOS bots >= 12 and
      # remove this exception once fixed.
      'Mac Builder Next': {
        'experiment_percentage': 100,
      },
      # TODO(crbug.com/40794640): dyld was rebuilt for macOS 12, which breaks
      # the tests. Run this experimentally on all the macOS bots >= 12 and
      # remove this exception once fixed.
      'mac-osxbeta-rel': {
        'experiment_percentage': 100,
      },
    },
  },
  'dawn_end2end_implicit_device_sync_tests': {
    'modifications': {
      'Dawn Win10 x64 ASAN Release (Intel)': {
        'swarming': {
          'shards': 2,
        }
      },
      'Dawn Win10 x64 ASAN Release (NVIDIA)': {
        'swarming': {
          'shards': 2,
        }
      }
    },
  },
  'dawn_end2end_no_dxc_tests': {
    'modifications': {
      'Dawn Win10 x64 ASAN Release (Intel)': {
        'swarming': {
          'shards': 2,
        }
      },
      'Dawn Win10 x64 ASAN Release (NVIDIA)': {
        'swarming': {
          'shards': 2,
        }
      }
    },
  },
  'dawn_end2end_skip_validation_tests': {
    'remove_from': [
      # TODO(crbug.com/40238674): Enable these once they're shown to work on
      # Android.
      'Dawn Android arm DEPS Release (Pixel 4)',
      'Dawn Android arm Release (Pixel 4)',
      'Dawn Android arm64 DEPS Release (Pixel 6)',
      'Dawn Android arm64 Experimental Release (Pixel 6)',
      'Dawn Android arm64 Release (Pixel 6)',
    ],
    'modifications': {
      'Dawn Win10 x64 ASAN Release (Intel)': {
        'swarming': {
          'shards': 2,
        }
      },
      'Dawn Win10 x64 ASAN Release (NVIDIA)': {
        'swarming': {
          'shards': 2,
        }
      }
    },
  },
  'dawn_end2end_tests': {
    'modifications': {
      'Dawn Win10 x64 ASAN Release (Intel)': {
        'swarming': {
          'shards': 2,
        }
      },
      'Dawn Win10 x64 ASAN Release (NVIDIA)': {
        'swarming': {
          'shards': 2,
        }
      }
    },
  },
  'dawn_end2end_validation_layers_tests': {
    'remove_from': [
      # TODO(crbug.com/40238674): Enable these once they're shown to work on
      # Android.
      'Dawn Android arm DEPS Release (Pixel 4)',
      'Dawn Android arm Release (Pixel 4)',
      'Dawn Android arm64 DEPS Release (Pixel 6)',
      'Dawn Android arm64 Experimental Release (Pixel 6)',
      'Dawn Android arm64 Release (Pixel 6)',
    ],
  },
  'dawn_end2end_wire_tests': {
    'remove_from': [
      # TODO(crbug.com/40238674): Enable these once they're shown to work on
      # Android.
      'Dawn Android arm DEPS Release (Pixel 4)',
      'Dawn Android arm Release (Pixel 4)',
      'Dawn Android arm64 DEPS Release (Pixel 6)',
      'Dawn Android arm64 Experimental Release (Pixel 6)',
      'Dawn Android arm64 Release (Pixel 6)',
    ],
    'modifications': {
      'Dawn Win10 x64 ASAN Release (Intel)': {
        'swarming': {
          'shards': 2,
        }
      },
      'Dawn Win10 x64 ASAN Release (NVIDIA)': {
        'swarming': {
          'shards': 2,
        }
      }
    },
  },
  'dawn_perf_tests': {
    'remove_from': [
      # TODO(crbug.com/40238674): Enable these once they're shown to work on
      # Android.
      'Dawn Android arm DEPS Release (Pixel 4)',
      'Dawn Android arm Release (Pixel 4)',
      'Dawn Android arm64 DEPS Release (Pixel 6)',
      'Dawn Android arm64 Experimental Release (Pixel 6)',
      'Dawn Android arm64 Release (Pixel 6)',
    ],
  },
  'expected_color_pixel_gl_passthrough_ganesh_test': {
    'replacements': {
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'expected_color_pixel_metal_passthrough_ganesh_test': {
    'remove_from': [
      # crbug.com/1458020 for Mac Retina ASAN removal
      'Mac FYI Retina ASAN (AMD)',
    ],
    'replacements': {
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'expected_color_pixel_metal_passthrough_graphite_test': {
    'remove_from': [
      # crbug.com/1458020 for Mac Retina ASAN removal
      'Mac FYI Retina ASAN (AMD)',
    ],
    'replacements': {
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'expected_color_pixel_passthrough_test': {
    'modifications': {
      'Android FYI Release (Pixel 4)': {
        'args': [
          # Pixel 4s are weird in that they can output in different color spaces
          # simultaneously. The readback code for capturing a screenshot assumes
          # only one color space, so disable wide color gamut for the test to
          # work around the issue. See https://crbug.com/1166379 for more
          # information.
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
      'android_optional_gpu_tests_rel': {
        'args': [
          # See above.
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
    },
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Linux V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Linux V8 FYI Release - pointer compression (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Win V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'expected_color_pixel_passthrough_test JACUZZI_RELEASE_LKGM': {
    'modifications': {
      'ChromeOS FYI Release Skylab (jacuzzi)': {
        'args': [
          # Skylab currently doesn't support use of LUCI_CONTEXT, so Gold cannot
          # automatically get the service account to authenticate with.
          '--service-account=/creds/service_accounts/skylab-drone.json',
        ],
      },
    },
  },
  'expected_color_pixel_passthrough_test VOLTEER_PUBLIC_RELEASE_LKGM': {
    'modifications': {
      'ChromeOS FYI Release Skylab (volteer)': {
        'args': [
          # Skylab currently doesn't support use of LUCI_CONTEXT, so Gold cannot
          # automatically get the service account to authenticate with.
          '--service-account=/creds/service_accounts/skylab-drone.json',
        ],
      },
    },
  },
  'expected_color_pixel_validating_test': {
    'modifications': {
      'Android FYI Release (Pixel 4)': {
        'args': [
          # Pixel 4s are weird in that they can output in different color spaces
          # simultaneously. The readback code for capturing a screenshot assumes
          # only one color space, so disable wide color gamut for the test to
          # work around the issue. See https://crbug.com/1166379 for more
          # information.
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
      'android_optional_gpu_tests_rel': {
        'args': [
          # See above.
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
    },
    # TODO(crbug.com/40039565): Remove the Android FYI Release (Pixel 2)
    # exception once there is enough capacity to run these tests.
    'remove_from': [
      'Android FYI Release (Pixel 2)',
    ],
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Android V8 FYI Release (Nexus 5X)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'gcp_unittests': {
    'modifications': {
      # Flakily times out with only a single shard due to slow runtime.
      'win-asan': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'gin_unittests': {
    'remove_from': [
      'Linux ASan LSan Tests (1)',  # https://crbug.com/831667
      'Linux Chromium OS ASan LSan Tests (1)',  # https://crbug.com/831667
    ],
  },
  'gl_tests_passthrough': {
    'remove_from': [
      # TODO(crbug.com/40238674): Enable these once they're shown to work on
      # Android.
      'Dawn Android arm DEPS Release (Pixel 4)',
      'Dawn Android arm Release (Pixel 4)',
      'Dawn Android arm64 DEPS Release (Pixel 6)',
      'Dawn Android arm64 Experimental Release (Pixel 6)',
      'Dawn Android arm64 Release (Pixel 6)',
      # Can't run on MSAN because gl_tests uses the hardware driver,
      # which isn't instrumented.
      'Linux MSan Tests',
    ],
    'modifications': {
      'Dawn Linux x64 Experimental Release (Intel UHD 630)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux.uhd_630.gl_tests_passthrough.filter',
        ],
      },
      'Dawn Linux x64 Release (Intel UHD 770)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux.uhd_770.gl_tests_passthrough.filter',
        ],
      },
      'Dawn Win10 x64 Release (Intel UHD 770)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/win.uhd_770.gl_tests_passthrough.filter',
        ],
      },
      # TODO(kbr): figure out a better way to specify blocks of
      # arguments like this for tests on multiple machines.
      'Linux ASan LSan Tests (1)': {
        'args': [
          '--use-gpu-in-tests',
          '--no-xvfb',
        ],
        'swarming': {
          # This must be kept in sync with linux_nvidia_gtx_1660_stable mixin
          'dimensions': {
            'gpu': '10de:2184-440.100',
            'os': 'Ubuntu-18.04.5|Ubuntu-18.04.6',
            'pool': 'chromium.tests.gpu',
          },
        },
      },
      'Linux CFI': {
        'args': [
          '--use-gpu-in-tests',
          '--no-xvfb',
        ],
        'swarming': {
          # This must be kept in sync with linux_nvidia_gtx_1660_stable mixin
          'dimensions': {
            'gpu': '10de:2184-440.100',
            'os': 'Ubuntu-18.04.5|Ubuntu-18.04.6',
            'pool': 'chromium.tests.gpu',
          },
        },
      },
      'Linux FYI Experimental Release (Intel UHD 630)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux.uhd_630.gl_tests_passthrough.filter',
        ],
      },
      'Linux FYI Release (Intel UHD 770)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux.uhd_770.gl_tests_passthrough.filter',
        ],
      },
      'Linux TSan Tests': {
        'args': [
          '--use-gpu-in-tests',
          '--no-xvfb',
        ],
        'swarming': {
          # This must be kept in sync with linux_nvidia_gtx_1660_stable mixin
          'dimensions': {
            'gpu': '10de:2184-440.100',
            'os': 'Ubuntu-18.04.5|Ubuntu-18.04.6',
            'pool': 'chromium.tests.gpu',
          },
        },
      },
      'Win10 FYI x64 Release (Intel UHD 770)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/win.uhd_770.gl_tests_passthrough.filter',
        ],
      },
    },
  },
  'gl_tests_validating': {
    'modifications': {
      'Android FYI Release (Samsung A13)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.samsung_a13.gl_tests.filter',
        ],
      },
      'Android FYI Release (Samsung A23)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.samsung_a23.gl_tests.filter',
        ],
      },
    },
  },
  'gl_unittests': {
    'remove_from': [
      # TODO(crbug.com/40238674): Enable these once they're shown to work on
      # Android.
      'Dawn Android arm DEPS Release (Pixel 4)',
      'Dawn Android arm Release (Pixel 4)',
      'Dawn Android arm64 DEPS Release (Pixel 6)',
      'Dawn Android arm64 Experimental Release (Pixel 6)',
      'Dawn Android arm64 Release (Pixel 6)',
      # Can't run on MSAN because gl_unittests uses the hardware driver,
      # which isn't instrumented.
      'Linux MSan Tests',
    ],
    'modifications': {
      'Win10 FYI x64 Release (AMD RX 5500 XT)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/win.amd.5500xt.gl_unittests.filter',
        ],
      },
    },
  },
  'gl_unittests_ozone': {
    'remove_from': [
      # Can't run on MSAN because gl_unittests_ozone uses the hardware driver,
      # which isn't instrumented.
      'Linux ChromiumOS MSan Tests',
    ],
  },
  'gpu_process_launch_tests': {
    'remove_from': [
      # TODO(crbug.com/40039565): Remove the Android FYI Release (Pixel 2)
      # exception once there is enough capacity to run these tests.
      'Android FYI Release (Pixel 2)',
      # crbug.com/1458020 for Mac Retina ASAN removal
      'Mac FYI Retina ASAN (AMD)',
    ],
  },
  'hardware_accelerated_feature_tests': {
    'remove_from': [
      # TODO(crbug.com/40039565): Remove the Android FYI Release (Pixel 2)
      # exception once there is enough capacity to run these tests.
      'Android FYI Release (Pixel 2)',
      # crbug.com/1458020 for Mac Retina ASAN removal
      'Mac FYI Retina ASAN (AMD)',
    ],
  },
  'headless_shell_wpt_tests': {
    'remove_from': [
      # TODO(crbug.com/360008882): Add the line below once the issue is fixed.
      'WebKit Linux MSAN',
    ],
  },
  'headless_shell_wpt_tests_include_all': {
    'modifications': {
      'linux-wpt-chromium-rel': {
        'args': [
          '--test-type',
          'testharness',
          'reftest',
          'crashtest',
          'print-reftest',
          '--exit-after-n-crashes-or-timeouts=10000',
          '--exit-after-n-failures=10000',
          '--no-retry-failures',
        ],
        'swarming': {
          'shards': 15,
        },
        'experiment_percentage': 100,
      },
      'mac13-wpt-chromium-rel': {
        'args': [
          '--test-type',
          'testharness',
          'reftest',
          'crashtest',
          'print-reftest',
          '--exit-after-n-crashes-or-timeouts=10000',
          '--exit-after-n-failures=10000',
          '--no-retry-failures',
        ],
        'experiment_percentage': 100,
      },
      'win10-wpt-chromium-rel': {
        'args': [
          '--test-type',
          'testharness',
          'reftest',
          'crashtest',
          'print-reftest',
          '--exit-after-n-crashes-or-timeouts=10000',
          '--exit-after-n-failures=10000',
          '--no-retry-failures',
        ],
        'experiment_percentage': 100,
      },
    },
  },
  'info_collection_tests': {
    'remove_from': [
      'Android V8 FYI Release (Nexus 5X)',
      'Linux V8 FYI Release (NVIDIA)',
      'Linux V8 FYI Release - pointer compression (NVIDIA)',
      # crbug.com/1458020 for Mac Retina ASAN removal
      'Mac FYI Retina ASAN (AMD)',
      'Mac V8 FYI Release (Intel)',
      'Win V8 FYI Release (NVIDIA)',
    ],
    'modifications': {
      'ChromeOS FYI Release (amd64-generic)': {
        'args': [
          # Swarming does not report a GPU since tests are run in a VM, but
          # the VM does report that a GPU is present.
          '--expected-vendor-id', '1af4',
          '--expected-device-id', '1050',
        ],
      },
    },
    'replacements': {
      'ChromeOS FYI Release (amd64-generic)': {
        'args': {
          # Magic substitution happens after regular replacement, so remove it
          # now since we are manually applying the expected device ID above.
          '$$MAGIC_SUBSTITUTION_GPUExpectedVendorId': None,
          '$$MAGIC_SUBSTITUTION_GPUExpectedDeviceId': None,
        },
      },
    },
  },
  'interactive_ui_tests': {
    'modifications': {
      'Linux - Future (dbg)': {  # client.v8.chromium
        'swarming': {
          'shards': 3,
        },
      },
      'Linux ASan LSan Tests (1)': {
        # Only retry the individual failed tests instead of rerunning entire
        # shards.
        'retry_only_failed_tests': True,
        # These are slow on the ASan trybot for some reason, crbug.com/1257927
        'swarming': {
          'shards': 12,
        },
      },
      'Linux CFI': {
        # Slow on certain debug builders, see crbug.com/1513713.
        'swarming': {
          'shards': 6,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are slow on the ASan trybot for some reason, crbug.com/1257927
        'swarming': {
          'shards': 12,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 5,
        },
      },
      'Linux MSan Tests': {
        'swarming': {
          'shards': 8,
        },
      },
      'Linux TSan Tests': {
        'ci_only': True, # https://crbug.com/1498240
        # Only retry the individual failed tests instead of rerunning entire
        # shards.
        'retry_only_failed_tests': True,
        # These are slow on the TSan bots for some reason, crbug.com/1257927
        'swarming': {
          'shards': 32, # Adjusted for testing, see https://crbug.com/1179567
        },
      },
      'Mac ASan 64 Tests (1)': { # https://crbug.com/1251656
        'experiment_percentage': 100,
      },
      'Mac Builder Next': {
        'swarming': {
          'shards': 7,
        },
      },
      'Mac Tests Siso FYI': {
        'swarming': {
          'shards': 6,
        },
      },
      # TODO(crbug.com/40630654): Remove these filters.
      'linux-chromeos-chrome': {
        'args': [
          '--gtest_filter=-SadTabViewInteractiveUITest.ReloadMultipleSadTabs',
        ],
      },
      'linux-chromeos-dbg': {
        'swarming': {
          'shards': 12,
        },
      },
      'linux-chromeos-dbg-oslogin': {
        'swarming': {
          'shards': 6,
        },
      },
      'linux-chromeos-rel': {
        # Only retry the individual failed tests instead of rerunning entire
        # shards.
        'retry_only_failed_tests': True,
        'swarming': {
          'shards': 5,
        },
      },
      'linux-ubsan-fyi-rel': {
        'swarming': {
          'shards': 6,
        }
      },
      # TODO (crbug.com/1278617) Re-enable once fixed
      'mac-osxbeta-rel': {
        'experiment_percentage': 100,
        'swarming': {
          'shards': 7,
        },
      },
      'win-asan': {
         # Tests shows tests run faster with fewer retries by using fewer jobs crbug.com/1411912
        'args': [
          '--test-launcher-jobs=3',
        ],
        'swarming': {
          'shards': 9,
        },
      },
    },
  },
  'interactive_ui_tests_no_field_trial': {
    'remove_from': [
      'win10-rel-no-external-ip',
    ],
  },
  'ipc_tests': {
    'modifications': {
      'android-asan': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'media_foundation_browser_tests': {
    'remove_from': [
      # TODO(crbug.com/40912267): Enable Media Foundation browser tests on NVIDIA
      # gpu bots once the Windows OS supports HW secure decryption.
      'Win10 FYI x64 Debug (NVIDIA)',
      'Win10 FYI x64 Release (AMD RX 5500 XT)',
      'Win10 FYI x64 Release (NVIDIA)',
      'Win10 FYI x86 Release (NVIDIA)',
    ],
  },
  'mediapipe_passthrough_tests': {
    'remove_from': [
      # crbug.com/1458020 for Mac Retina ASAN removal
      'Mac FYI Retina ASAN (AMD)',
    ],
  },
  'model_validation_tests MODEL_VALIDATION_BASE': {
    'modifications': {
      'optimization_guide-win32': {
        'args': [
          '--target-platform=win32',
        ],
      },
    },
  },
  'mojo_unittests': {
    'modifications': {
      'android-asan': {
        'swarming': {
          'shards': 5,
        },
      },
    },
  },
  'nacl_loader_unittests': {
    # If you change this, make similar changes in ppapi_unittests
    'remove_from': [
      'Linux TSan Tests',  # The TSan bot sets enable_nacl=false
      'Mac ASan 64 Tests (1)',  # The mac asan bot sets enable_nacl=false
    ],
  },
  'net_unittests': {
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 16,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 8,
        }
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 2,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 4,
        }
      },
      'linux-chromeos-dbg': {
        'swarming': {
          'shards': 2,
        },
      },
      'linux-chromeos-dbg-oslogin': {
        'swarming': {
          'shards': 2,
        },
      },
      'win-asan': {
        # TODO(crbug.com/40200867): net_unittests is slow under ASan.
        'swarming': {
          'shards': 16,
        },
      },
    },
  },
  'net_unittests RELEASE_LKGM': {
    # TODO(b/319364912): vpython cannot be delivered via CIPD on skylab builders
    'remove_from': [
      'chromeos-brya-chrome-dchecks-skylab',
      'chromeos-brya-chrome-skylab',
      'chromeos-brya-chrome-tests',
    ],
  },
  'notification_helper_unittests': {
    'remove_from': [
      # all these bots run Windows 7.
      'ToTWinOfficial',
      'ToTWinOfficial64',
    ],
  },
  'ondevice_stability_tests AMD Radeon RX 5500 XT': {
    'modifications': {
      'optimization_guide-win32': {
        'args': [
          '--target-platform=win32',
        ],
      },
    },
  },
  'ondevice_stability_tests Intel UHD 630': {
    'modifications': {
      'optimization_guide-win32': {
        'args': [
          '--target-platform=win32',
        ],
      },
    },
  },
  'ondevice_stability_tests NVIDIA GeForce GTX 1660': {
    'modifications': {
      'optimization_guide-win32': {
        'args': [
          '--target-platform=win32',
        ],
      },
    },
  },
  'ozone_unittests': {
    'modifications': {
      'linux-chromeos-chrome': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.ozone_unittests.filter',
        ],
      },
      'linux-chromeos-chrome-preuprev': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.ozone_unittests.filter',
        ],
      },
    },
  },
  'perfetto_unittests': {
    'remove_from': [
      # TODO(crbug.com/41440830): Fix permission issue when creating tmp files
      'android-asan',
    ]
  },
  'pixel_skia_gold_gl_passthrough_ganesh_test': {
    'replacements': {
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'pixel_skia_gold_metal_passthrough_ganesh_test': {
    'remove_from': [
      # crbug.com/1458020 for Mac Retina ASAN removal
      'Mac FYI Retina ASAN (AMD)',
    ],
    'replacements': {
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'pixel_skia_gold_metal_passthrough_graphite_test': {
    'remove_from': [
      # crbug.com/1458020 for Mac Retina ASAN removal
      'Mac FYI Retina ASAN (AMD)',
    ],
    'replacements': {
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'pixel_skia_gold_passthrough_test': {
    'modifications': {
      'Android FYI Release (Pixel 4)': {
        'args': [
          # Pixel 4s are weird in that they can output in different color spaces
          # simultaneously. The readback code for capturing a screenshot assumes
          # only one color space, so disable wide color gamut for the test to
          # work around the issue. See https://crbug.com/1166379 for more
          # information.
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
      'Win10 FYI x64 Experimental Release (Intel)': {
        'args': [
          # TODO(crbug.com/41496675): Apply this via magic subustitutions if it
          # helps with stability.
          '--jobs=2',
        ],
      },
      'android_optional_gpu_tests_rel': {
        'args': [
          # See above.
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
    },
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Linux V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Linux V8 FYI Release - pointer compression (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Win V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Win10 FYI x64 Experimental Release (Intel)': {
        'args': {
          # Magic substitution happens after regular replacement, so remove it
          # now since we are manually applying the number of jobs above.
          '$$MAGIC_SUBSTITUTION_GPUParallelJobs': None,
        },
      },
    },
  },
  'pixel_skia_gold_passthrough_test JACUZZI_RELEASE_LKGM': {
    'modifications': {
      'ChromeOS FYI Release Skylab (jacuzzi)': {
        'args': [
          # Skylab currently doesn't support use of LUCI_CONTEXT, so Gold cannot
          # automatically get the service account to authenticate with.
          '--service-account=/creds/service_accounts/skylab-drone.json',
        ],
      },
    },
  },
  'pixel_skia_gold_passthrough_test VOLTEER_PUBLIC_RELEASE_LKGM': {
    'modifications': {
      'ChromeOS FYI Release Skylab (volteer)': {
        'args': [
          # Skylab currently doesn't support use of LUCI_CONTEXT, so Gold cannot
          # automatically get the service account to authenticate with.
          '--service-account=/creds/service_accounts/skylab-drone.json',
        ],
      },
    },
  },
  'pixel_skia_gold_validating_test': {
    'modifications': {
      'Android FYI Release (Pixel 4)': {
        'args': [
          # Pixel 4s are weird in that they can output in different color spaces
          # simultaneously. The readback code for capturing a screenshot assumes
          # only one color space, so disable wide color gamut for the test to
          # work around the issue. See https://crbug.com/1166379 for more
          # information.
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
      'android_optional_gpu_tests_rel': {
        'args': [
          # See above.
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
    },
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Android V8 FYI Release (Nexus 5X)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'ppapi_unittests': {
    # If you change this, make similar changes in nacl_loader_unittests
    'remove_from': [
      'Linux TSan Tests',  # The TSan bot sets enable_nacl=false
      'Mac ASan 64 Tests (1)',  # The mac asan bot sets enable_nacl=false
    ],
  },
  'pthreadpool_unittests': {
    'remove_from': [
      # pthreadpool is not built for ChromeOS currently.
      'linux-chromeos-dbg',
      'linux-chromeos-dbg-oslogin',
      'linux-chromeos-rel',
    ],
  },
  'sandbox_linux_unittests': {
    'remove_from': [
      'android-asan',  # https://crbug.com/962650
    ],
  },
  'screenshot_sync_metal_passthrough_ganesh_tests': {
    'remove_from': [
      # crbug.com/1458020 for Mac Retina ASAN removal
      'Mac FYI Retina ASAN (AMD)',
    ],
  },
  'screenshot_sync_metal_passthrough_graphite_tests': {
    'remove_from': [
      # crbug.com/1458020 for Mac Retina ASAN removal
      'Mac FYI Retina ASAN (AMD)',
    ],
  },
  'screenshot_sync_passthrough_tests': {
    'modifications': {
      'Android FYI Release (Pixel 4)': {
        'args': [
          # Pixel 4s are weird in that they can output in different color spaces
          # simultaneously. The readback code for capturing a screenshot assumes
          # only one color space, so disable wide color gamut for the test to
          # work around the issue. See https://crbug.com/1166379 for more
          # information.
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
      'android_optional_gpu_tests_rel': {
        'args': [
          # See above.
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
    },
  },
  'screenshot_sync_validating_tests': {
    'modifications': {
      'Android FYI Release (Pixel 4)': {
        'args': [
          # Pixel 4s are weird in that they can output in different color spaces
          # simultaneously. The readback code for capturing a screenshot assumes
          # only one color space, so disable wide color gamut for the test to
          # work around the issue. See https://crbug.com/1166379 for more
          # information.
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
      'android_optional_gpu_tests_rel': {
        'args': [
          # See above.
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
    },
  },
  'services_unittests': {
    'remove_from': [
      # The face and barcode detection tests fail on the Mac Pros.
      'Mac Pro FYI Release (AMD)',
      'Linux ChromiumOS MSan Tests',  # https://crbug.com/831676
      'Linux MSan Tests',  # https://crbug.com/831676
    ],
  },
  'sync_integration_tests': {
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        'swarming': {
          'shards': 4,
        },
      },
      'Linux TSan Tests': {
        'ci_only': True, # https://crbug.com/1498240
        'swarming': {
          'shards': 6,
        },
      },
      'Mac ASan 64 Tests (1)': {
        'swarming': {
          'shards': 3,
          },
      },
      'Mac Tests Siso FYI': {
        'ci_only': True,
        'swarming': {
          'shards': 4,
        },
      },
      'linux-chromeos-rel': {
        'swarming': {
          'shards': 2,
        },
      },
      'win-asan': {
         # Tests shows tests run faster with fewer retries by using fewer jobs crbug.com/1411912
        'args': [
          '--test-launcher-jobs=3',
        ],
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'sync_integration_tests_no_field_trial': {
    'remove_from': [
      'win10-rel-no-external-ip',
    ],
  },
  'tab_capture_end2end_tests': {
    # Run these only on Release bots.
    'remove_from': [
      'Win10 FYI x64 Debug (NVIDIA)',
      # Disabled due to dbus crashes crbug.com/927465
      'Linux FYI Release (Intel UHD 630)',
      'Linux FYI Release (NVIDIA)',
    ],
  },
  'telemetry_perf_unittests': {
    'modifications': {
      'chromeos-eve-chrome': {
        'args': [
          # TODO(crbug.com/40756418): Re-enable.
          '--skip=benchmarks.benchmark_smoke_unittest.BenchmarkSmokeTest.wasmpspdfkit',
        ],
      },
      'linux-rel-no-external-ip': {
        'args': [
          '--xvfb',
          '--jobs=1',
        ],
      },
    },
    'remove_from': [
      'Linux - Future (dbg)',  # client.v8.chromium
      'win10-rel-no-external-ip',
    ],
  },
  'telemetry_unittests': {
    'remove_from': [
      # TODO(crbug.com/40727045): Restore when there's more DUTs
      'chromeos-eve-chrome',
      'win10-rel-no-external-ip',
    ],
  },
  'trace_test': {
    'modifications': {
      'Win10 FYI x64 Experimental Release (Intel)': {
        'args': [
          # TODO(crbug.com/41496675): Apply this via magic subustitutions if it
          # helps with stability.
          '--jobs=2',
        ],
      },
    },
    'replacements': {
      'Win10 FYI x64 Experimental Release (Intel)': {
        'args': {
          # Magic substitution happens after regular replacement, so remove it
          # now since we are manually applying the number of jobs above.
          '$$MAGIC_SUBSTITUTION_GPUParallelJobs': None,
        },
      },
    },
    'remove_from': [
      # crbug.com/1458020 for Mac Retina ASAN removal
      'Mac FYI Retina ASAN (AMD)',
    ],
  },
  'trace_test 8086:9bc5': {
    'remove_from': [
      # TODO(crbug.com/41483572): Re-add this when capacity issues are resolved.
      'win_optional_gpu_tests_rel',
    ],
  },
  'unit_tests': {
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # Only retry the individual failed tests instead of rerunning entire
        # shards.
        'retry_only_failed_tests': True,
        # These are slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 4,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 4,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 2,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 2,
        },
      },
      'Mac ASan 64 Tests (1)': {
        'swarming': {
          'shards': 2,
        },
      },
      'Mac Tests Siso FYI': {
        'swarming': {
          'shards': 2,
        },
      },
      'android-asan': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.asan.unit_tests.filter',
        ],
      },
      'android-pie-arm64-rel-dev': {
        'swarming': {
          'shards': 8,
        },
      },
      'linux-chromeos-chrome': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.unit_tests.filter',
        ],
      },
      'linux-chromeos-chrome-preuprev': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.unit_tests.filter',
        ],
      },
      'linux-chromeos-dbg': {
        'swarming': {
          'shards': 4,
        },
      },
      'linux-chromeos-dbg-oslogin': {
        'swarming': {
          'shards': 4,
        },
      },
      'linux-chromeos-rel': {
        # Only retry the individual failed tests instead of rerunning entire
        # shards.
        'retry_only_failed_tests': True,
        'swarming': {
          'shards': 2,
        },
      },
      'linux-ubsan-fyi-rel': {
        'swarming': {
          'shards': 2,
        }
      },
      'win-asan': {
        'swarming': {
          # ASAN bot is slow: https://crbug.com/1484550#c4
          'shards': 4,
        },
      },
    },
  },
  'updater_tests_system': {
    'modifications': {
      'win-asan': {
        # crbug.com/369478225: These are slow and could timeout on the ASAN
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'variations_smoke_tests': {
    'modifications': {
      'linux-chrome': {
        'swarming': {
          'dimensions': {
            'pool': 'chrome.tests.finch',
          },
        },
      },
      'win-chrome': {
        'experiment_percentage': 100,
        'swarming': {
          'dimensions': {
            'pool': 'chrome.tests.finch',
          },
        },
      },
    },
  },
  'video_decode_accelerator_gl_unittest': {
    'remove_from': [
      # Windows Intel doesn't have the GL extensions to support this test.
      'Win10 FYI x64 Release (Intel)',
      'Win10 FYI x64 Experimental Release (Intel)',
    ],
  },
  'vulkan_pixel_skia_gold_test': {
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Linux V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Linux V8 FYI Release - pointer compression (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Win V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'wayland_client_perftests': {
    'remove_from': [
      'linux-chromeos-dbg',  # https://crbug.com/859307
      'linux-chromeos-dbg-oslogin',
    ],
  },
  'webcodecs_metal_passthrough_ganesh_tests': {
    'remove_from': [
      # crbug.com/1458020 for Mac Retina ASAN removal
      'Mac FYI Retina ASAN (AMD)',
    ],
  },
  'webcodecs_metal_passthrough_graphite_tests': {
    'remove_from': [
      # crbug.com/1458020 for Mac Retina ASAN removal
      'Mac FYI Retina ASAN (AMD)',
    ],
  },
  'webcodecs_tests': {
    'modifications': {
      'Win10 FYI x64 Experimental Release (Intel)': {
        'args': [
          # TODO(crbug.com/41496675): Apply this via magic subustitutions if it
          # helps with stability.
          '--jobs=2',
        ],
      },
    },
    'replacements': {
      'Win10 FYI x64 Experimental Release (Intel)': {
        'args': {
          # Magic substitution happens after regular replacement, so remove it
          # now since we are manually applying the number of jobs above.
          '$$MAGIC_SUBSTITUTION_GPUParallelJobs': None,
        },
      },
    },
  },
  'webgl2_conformance_d3d11_passthrough_tests': {
    'remove_from': [
      # Removed from V8 builder since WebGL 1 should provide reasonable
      # upstream test coverage without the capacity hit from WebGL 2.
      'Win V8 FYI Release (NVIDIA)',
    ],
  },
  'webgl2_conformance_d3d11_passthrough_tests 8086:9bc5': {
    'remove_from': [
      # TODO(crbug.com/41483572): Re-add this when capacity issues are resolved.
      'win_optional_gpu_tests_rel',
    ],
  },
  'webgl2_conformance_gl_passthrough_ganesh_tests': {
    'remove_from': [
      'Mac V8 FYI Release (Intel)',
    ],
  },
  'webgl2_conformance_gl_passthrough_tests': {
    'remove_from': [
      # Removed from V8 builders since WebGL 1 should provide reasonable
      # upstream test coverage without the capacity hit from WebGL 2.
      'Linux V8 FYI Release - pointer compression (NVIDIA)',
    ],
  },
  'webgl2_conformance_gles_passthrough_tests': {
    'remove_from': [
      # Not enough CrOS hardware capacity to run both on anything other than
      # VMs. See https://crbug.com/1238070.
      'Linux Wayland FYI Release (Intel)',
    ],
    'modifications': {
      # This VM configuration is known to be significantly slower than other
      # CrOS configurations, so increase the shards.
      # TODO(crbug.com/40774693): Remove this if the configuration can be sped
      # up.
      'ChromeOS FYI Release (amd64-generic)': {
        'swarming': {
          'shards': 30,
        },
      },
    },
  },
  'webgl2_conformance_metal_passthrough_graphite_tests': {
    'remove_from': [
      # crbug.com/1270755
      'Mac FYI ASAN (Intel)',
      'Mac FYI Retina ASAN (AMD)',
      # Not enough capacity.
      'Mac FYI Retina Release (NVIDIA)',
      'Mac FYI Experimental Retina Release (NVIDIA)',
      # Removed from V8 builders since WebGL 1 should provide reasonable
      # upstream test coverage without the capacity hit from WebGL 2.
      'Mac V8 FYI Release (Intel)',
    ],
    'modifications': {
      'Mac FYI ASAN (Intel)': {
        'args': [
          '--extra-browser-args=--disable-metal-shader-cache',
        ],
      },
      'Mac FYI Retina ASAN (AMD)': {
        'args': [
          '--extra-browser-args=--disable-metal-shader-cache',
        ],
      },
    },
    'replacements': {
      'Mac Pro FYI Release (AMD)': {
        'args': {
          # Causes problems on older hardware. crbug.com/1499911.
          '--enable-metal-debug-layers': None,
        },
      },
    },
  },
  'webgl2_conformance_validating_tests': {
    'modifications': {
      # This VM configuration is known to be significantly slower than other
      # CrOS configurations, so increase the shards.
      # TODO(crbug.com/40774693): Remove this if the configuration can be sped
      # up.
      'ChromeOS FYI Release (amd64-generic)': {
        'swarming': {
          'shards': 30,
        },
        # This configuration is tested with the passthrough decoder as well,
        # which will be shipped in the nearish future, so any failures that
        # show up with the validating decoder are just an FYI.
        'experiment_percentage': 100,
      },
    },
  },
  'webgl_conformance_metal_passthrough_ganesh_tests': {
    'remove_from': [
      # crbug.com/1270755
      'Mac FYI ASAN (Intel)',
      'Mac FYI Retina ASAN (AMD)',
    ],
  },
  'webgl_conformance_metal_passthrough_graphite_tests': {
    'remove_from': [
      # crbug.com/1270755
      'Mac FYI ASAN (Intel)',
      'Mac FYI Retina ASAN (AMD)',
      # crbug.com/1158857: re-enable when switching to Metal by default.
      'Mac FYI Retina Release (NVIDIA)',
      'Mac FYI Experimental Retina Release (NVIDIA)',
    ],
    'modifications': {
      'Mac FYI ASAN (Intel)': {
        'args': [
          '--extra-browser-args=--disable-metal-shader-cache',
        ],
      },
      'Mac FYI Retina ASAN (AMD)': {
        'args': [
          '--extra-browser-args=--disable-metal-shader-cache',
        ],
      },
    },
    'replacements': {
      'Mac Pro FYI Release (AMD)': {
        'args': {
          # Causes problems on older hardware. crbug.com/1499911.
          '--enable-metal-debug-layers': None,
        },
      },
    },
  },
  'webgpu_blink_web_tests': {
    'remove_from': [
      # TODO(crbug.com/40238674): Enable these once they're shown to work on
      # Android.
      'Dawn Android arm DEPS Release (Pixel 4)',
      'Dawn Android arm Release (Pixel 4)',
      'Dawn Android arm64 DEPS Release (Pixel 6)',
      'Dawn Android arm64 Experimental Release (Pixel 6)',
      'Dawn Android arm64 Release (Pixel 6)',
    ],
  },
  'webgpu_blink_web_tests_with_backend_validation': {
    'remove_from': [
      # TODO(crbug.com/40238674): Enable these once they're shown to work on
      # Android.
      'Dawn Android arm DEPS Release (Pixel 4)',
      'Dawn Android arm Release (Pixel 4)',
      'Dawn Android arm64 DEPS Release (Pixel 6)',
      'Dawn Android arm64 Experimental Release (Pixel 6)',
      'Dawn Android arm64 Release (Pixel 6)',
      # Remove from bots where capacity is constrained.
      'Dawn Win10 x64 DEPS Release (Intel)',
      'Dawn Win10 x64 Experimental Release (Intel)',
      'Dawn Win10 x64 Release (Intel)',
    ],
  },
  'webgpu_cts_compat_tests': {
    'modifications': {
      # TODO(crbug.com/40932096): Enable on Intel trybots once there is
      # sufficient capacity.
      'Dawn Linux x64 DEPS Release (Intel UHD 630)': {
        'ci_only': True,
        'experiment_percentage': 100,
      },
      'Dawn Linux x64 Experimental Release (Intel UHD 630)': {
        'ci_only': True,
        'experiment_percentage': 100,
      },
      'Dawn Linux x64 Release (Intel UHD 630)': {
        'ci_only': True,
        'experiment_percentage': 100,
      },
    },
  },
  'webgpu_cts_dedicated_worker_tests': {
    'remove_from': [
      # We only need coverage on one GPU per OS, so remove from lower capacity
      # configs.
      'Dawn Linux x64 DEPS Release (Intel UHD 630)',
      'Dawn Linux x64 Experimental Release (Intel UHD 630)',
      'Dawn Linux x64 Release (Intel UHD 630)',
      'Dawn Mac x64 DEPS Release (AMD)',
      'Dawn Mac x64 DEPS Release (Intel)',
      'Dawn Mac x64 Experimental Release (AMD)',
      'Dawn Mac x64 Experimental Release (Intel)',
      'Dawn Mac x64 Release (AMD)',
      'Dawn Mac x64 Release (Intel)',
      'Dawn Win10 x64 ASAN Release (Intel)',
      'Dawn Win10 x64 DEPS Release (Intel)',
      'Dawn Win10 x64 Experimental Release (Intel)',
      'Dawn Win10 x64 Release (Intel)',
      'Dawn Win10 x86 DEPS Release (Intel)',
      'Dawn Win10 x86 Experimental Release (Intel)',
      'Dawn Win10 x86 Release (Intel)',
    ],
  },
  'webgpu_cts_fxc_tests': {
    'modifications': {
      'Dawn Win10 x64 ASAN Release (Intel)': {
        # ASAN builds taking a bit longer so needs extra shards to not timeout.
        'swarming': {
          'shards': 14,
        }
      },
    },
  },
  'webgpu_cts_fxc_with_validation_tests': {
    'remove_from': [
      # Disable testing with validation on x86 where they frequently OOM.
      # See crbug.com/1444815.
      'Dawn Win10 x86 DEPS Release (Intel)',
      'Dawn Win10 x86 Release (Intel)',
      'Dawn Win10 x86 Experimental Release (Intel)',
      'Dawn Win10 x86 DEPS Release (NVIDIA)',
      'Dawn Win10 x86 Release (NVIDIA)',
    ],
  },
  'webgpu_cts_service_worker_tests': {
    'remove_from': [
      # We only need coverage on one GPU per OS, so remove from lower capacity
      # configs.
      'Dawn Linux x64 DEPS Release (Intel UHD 630)',
      'Dawn Linux x64 Experimental Release (Intel UHD 630)',
      'Dawn Linux x64 Release (Intel UHD 630)',
      'Dawn Mac x64 DEPS Release (AMD)',
      'Dawn Mac x64 DEPS Release (Intel)',
      'Dawn Mac x64 Experimental Release (AMD)',
      'Dawn Mac x64 Experimental Release (Intel)',
      'Dawn Mac x64 Release (AMD)',
      'Dawn Mac x64 Release (Intel)',
      'Dawn Win10 x64 ASAN Release (Intel)',
      'Dawn Win10 x64 DEPS Release (Intel)',
      'Dawn Win10 x64 Experimental Release (Intel)',
      'Dawn Win10 x64 Release (Intel)',
      'Dawn Win10 x86 DEPS Release (Intel)',
      'Dawn Win10 x86 Experimental Release (Intel)',
      'Dawn Win10 x86 Release (Intel)',
    ],
  },
  'webgpu_cts_shared_worker_tests': {
    'remove_from': [
      # We only need coverage on one GPU per OS, so remove from lower capacity
      # configs. Additionally, shared workers are not supported on Android, so
      # remove tests from there.
      'Dawn Android arm DEPS Release (Pixel 4)',
      'Dawn Android arm Release (Pixel 4)',
      'Dawn Android arm64 DEPS Release (Pixel 6)',
      'Dawn Android arm64 Experimental Release (Pixel 6)',
      'Dawn Android arm64 Release (Pixel 6)',
      'Dawn Linux x64 DEPS Release (Intel UHD 630)',
      'Dawn Linux x64 Experimental Release (Intel UHD 630)',
      'Dawn Linux x64 Release (Intel UHD 630)',
      'Dawn Mac x64 DEPS Release (AMD)',
      'Dawn Mac x64 DEPS Release (Intel)',
      'Dawn Mac x64 Experimental Release (AMD)',
      'Dawn Mac x64 Experimental Release (Intel)',
      'Dawn Mac x64 Release (AMD)',
      'Dawn Mac x64 Release (Intel)',
      'Dawn Win10 x64 ASAN Release (Intel)',
      'Dawn Win10 x64 DEPS Release (Intel)',
      'Dawn Win10 x64 Experimental Release (Intel)',
      'Dawn Win10 x64 Release (Intel)',
      'Dawn Win10 x86 DEPS Release (Intel)',
      'Dawn Win10 x86 Experimental Release (Intel)',
      'Dawn Win10 x86 Release (Intel)',
    ],
  },
  'webgpu_cts_tests': {
    'modifications': {
      'Dawn Android arm DEPS Release (Pixel 4)': {
        'ci_only': True,
      },
      'Dawn Android arm Release (Pixel 4)': {
        'ci_only': True,
      },
      'Dawn Win10 x64 ASAN Release (Intel)': {
        # ASAN builds taking a bit longer so needs extra shards to not timeout.
        'swarming': {
          'shards': 16,
        }
      },
    },
  },
  'webgpu_cts_with_validation_tests': {
    'remove_from': [
      # Remove from bots where capacity is constrained.
      'Dawn Win10 x64 DEPS Release (Intel)',
      'Dawn Win10 x64 Experimental Release (Intel)',
      'Dawn Win10 x64 Release (Intel)',
    ],
    'modifications': {
      'Dawn Android arm DEPS Release (Pixel 4)': {
        'ci_only': True,
      },
      'Dawn Android arm Release (Pixel 4)': {
        'ci_only': True,
      },
      # ci_only for bots where capacity is constrained.
      'Dawn Linux x64 DEPS Release (Intel UHD 630)': {
        'ci_only': True,
      },
      'Dawn Linux x64 Experimental Release (Intel UHD 630)': {
        'ci_only': True,
      },
      'Dawn Linux x64 Release (Intel UHD 630)': {
        'ci_only': True,
      },
    },
  },
  'webgpu_swiftshader_web_platform_cts_with_validation_tests': {
    # Remove from bots where capacity is constrained.
    'remove_from': [
      'Dawn Win10 x64 DEPS Release (Intel)',
      'Dawn Win10 x64 Experimental Release (Intel)',
      'Dawn Win10 x64 Release (Intel)',
      'Dawn Win10 x86 DEPS Release (Intel)',
      'Dawn Win10 x86 Experimental Release (Intel)',
      'Dawn Win10 x86 Release (Intel)',
    ],
    'modifications': {
      # ci_only for bots where capacity is constrained.
      'Dawn Linux x64 DEPS Release (Intel UHD 630)': {
        'ci_only': True,
      },
      'Dawn Linux x64 Experimental Release (Intel UHD 630)': {
        'ci_only': True,
      },
      'Dawn Linux x64 Release (Intel UHD 630)': {
        'ci_only': True,
      },
    },
  },
  'webkit_unit_tests': {
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/1257927
        'swarming': {
          'shards': 5,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 2,
        },
      },
      'linux-ubsan-fyi-rel': {
        'swarming': {
          'shards': 2,
        }
      },
      'win-asan': {
        'swarming': {
          'shards': 6,
        },
      },
    },
  },
  'webkit_unit_tests_v2':{
    'modifications': {
      'win-asan': {
        'swarming': {
          'shards': 6,  # crbug.com/326231701
        },
      },
    },
  },
  'webview_instrumentation_test_apk_multiple_process_mode': {
    'remove_from': [
      'android-asan',  # https://crbug.com/964562
    ],
  },
  'xr_browser_tests': {
    'modifications': {
      'Win10 FYI x64 Experimental Release (Intel)': {
        'args': [
          # TODO(crbug.com/40937024): Remove this once the flakes on Intel are
          # resolved.
          '--gtest_filter=-WebXrVrOpenXrBrowserTest.TestNoStalledFrameLoop',
        ],
      },
      'Win10 FYI x64 Release (Intel UHD 770)': {
        'args': [
          # TODO(crbug.com/40937024): Remove this once the flakes on Intel are
          # resolved.
          '--gtest_filter=-WebXrVrOpenXrBrowserTest.TestNoStalledFrameLoop',
        ],
      },
      'Win10 FYI x64 Release (Intel)': {
        'args': [
          # TODO(crbug.com/40937024): Remove this once the flakes on Intel are
          # resolved.
          '--gtest_filter=-WebXrVrOpenXrBrowserTest.TestNoStalledFrameLoop',
        ],
      },
    },
  },
  'xr_browser_tests 8086:9bc5': {
    'modifications': {
      'win_optional_gpu_tests_rel': {
        'args': [
           # TODO(crbug.com/40937024): Remove this once the flakes on Intel are
           # resolved.
           '--gtest_filter=-WebXrVrOpenXrBrowserTest.TestNoStalledFrameLoop',
        ],
      },
    },
  },
}
